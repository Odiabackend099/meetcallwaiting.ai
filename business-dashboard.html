<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Callwaiting AI - Business Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #01C6D6 0%, #0A5AA8 50%, #16E0C1 100%); color: white; padding: 1rem; }
        .header h1 { font-size: 1.5rem; }
        .header p { opacity: 0.9; margin-top: 0.5rem; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .grid { display: grid; gap: 1.5rem; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        .card { background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-card { text-align: center; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #01C6D6; }
        .stat-label { color: #666; margin-top: 0.5rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; text-decoration: none; display: inline-block; text-align: center; }
        .btn-primary { background: #01C6D6; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .status-connected { color: #28a745; font-weight: bold; }
        .status-disconnected { color: #dc3545; font-weight: bold; }
        .activity-list { max-height: 300px; overflow-y: auto; }
        .activity-item { padding: 1rem; border-bottom: 1px solid #eee; }
        .activity-time { color: #666; font-size: 0.875rem; }
        .tabs { border-bottom: 1px solid #ddd; margin-bottom: 1rem; }
        .tab { padding: 0.75rem 1rem; border: none; background: none; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: #01C6D6; color: #01C6D6; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .phone-number { font-family: 'Courier New', monospace; font-size: 1.25rem; background: #f8f9fa; padding: 0.5rem; border-radius: 4px; }
        .setup-checklist { list-style: none; }
        .setup-checklist li { padding: 0.5rem 0; }
        .setup-checklist .done::before { content: '‚úÖ '; }
        .setup-checklist .pending::before { content: '‚è≥ '; }
        .setup-checklist .error::before { content: '‚ùå '; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üè¢ Business Dashboard</h1>
            <p id="business-name">Loading business information...</p>
        </div>
    </div>

    <div class="container">
        <!-- Key Metrics -->
        <div class="grid grid-4" style="margin-bottom: 2rem;">
            <div class="card stat-card">
                <div class="stat-number" id="total-calls">--</div>
                <div class="stat-label">Total Calls Today</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="orders-captured">--</div>
                <div class="stat-label">Orders Captured</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="bookings-made">--</div>
                <div class="stat-label">Bookings Made</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="revenue-today">$--</div>
                <div class="stat-label">Revenue Today</div>
            </div>
        </div>

        <div class="grid grid-2">
            <!-- Setup Status -->
            <div class="card">
                <h3>üîß Setup Status</h3>
                <ul class="setup-checklist" id="setup-status">
                    <li class="pending">Business Account Created</li>
                    <li class="pending">AI Phone Number Assigned</li>
                    <li class="pending">Payment Provider Connected</li>
                    <li class="pending">Calendar Integrated</li>
                    <li class="pending">Voice AI Tested</li>
                    <li class="pending">Live and Capturing Calls</li>
                </ul>
                <div style="margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="runSetupWizard()">Complete Setup</button>
                </div>
            </div>

            <!-- AI Phone Number -->
            <div class="card">
                <h3>üìû Your AI Phone Number</h3>
                <div class="phone-number" id="ai-phone-number">
                    Loading...
                </div>
                <p style="margin: 1rem 0;">Forward your missed calls to this number to capture orders and bookings automatically.</p>
                <div>
                    <button class="btn btn-secondary" onclick="showCallForwarding()">Setup Call Forwarding</button>
                    <button class="btn btn-warning" onclick="testAI()">Test AI</button>
                </div>
            </div>
        </div>

        <!-- Tabs for detailed views -->
        <div class="card" style="margin-top: 2rem;">
            <div class="tabs">
                <button class="tab active" onclick="showTab('activity')">Recent Activity</button>
                <button class="tab" onclick="showTab('orders')">Orders</button>
                <button class="tab" onclick="showTab('bookings')">Bookings</button>
                <button class="tab" onclick="showTab('settings')">Settings</button>
            </div>

            <div id="activity-tab" class="tab-content active">
                <h4>üìã Recent Activity</h4>
                <div class="activity-list" id="activity-list">
                    <div class="activity-item">
                        <div class="activity-time">Today, 2:30 PM</div>
                        <div>Customer called +1 (555) 123-4567 - Order placed for $24.99</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">Today, 1:15 PM</div>
                        <div>Appointment booked - Haircut scheduled for tomorrow 3 PM</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">Today, 11:45 AM</div>
                        <div>Customer left voicemail - Transcript available</div>
                    </div>
                </div>
            </div>

            <div id="orders-tab" class="tab-content">
                <h4>üõí Orders</h4>
                <p>Track all orders captured by your AI assistant.</p>
                <table style="width: 100%; margin-top: 1rem;">
                    <thead>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <th style="text-align: left; padding: 0.5rem;">Time</th>
                            <th style="text-align: left; padding: 0.5rem;">Customer</th>
                            <th style="text-align: left; padding: 0.5rem;">Amount</th>
                            <th style="text-align: left; padding: 0.5rem;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table">
                        <tr>
                            <td style="padding: 0.5rem;">2:30 PM</td>
                            <td style="padding: 0.5rem;">+1 (555) 123-4567</td>
                            <td style="padding: 0.5rem;">$24.99</td>
                            <td style="padding: 0.5rem;"><span class="status-connected">Paid</span></td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">1:45 PM</td>
                            <td style="padding: 0.5rem;">+1 (555) 987-6543</td>
                            <td style="padding: 0.5rem;">$18.50</td>
                            <td style="padding: 0.5rem;"><span class="status-connected">Paid</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="bookings-tab" class="tab-content">
                <h4>üìÖ Bookings</h4>
                <p>Manage appointments booked through your AI assistant.</p>
                <div style="margin-top: 1rem;" id="bookings-list">
                    <div class="activity-item">
                        <div class="activity-time">Tomorrow, 3:00 PM</div>
                        <div><strong>Haircut & Color</strong> - Customer: +1 (555) 123-4567</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">Tuesday, 10:30 AM</div>
                        <div><strong>Consultation</strong> - Customer: +1 (555) 456-7890</div>
                    </div>
                </div>
            </div>

            <div id="settings-tab" class="tab-content">
                <h4>‚öôÔ∏è Settings</h4>
                <div class="grid grid-2">
                    <div>
                        <h5>Payment Provider</h5>
                        <p>Status: <span class="status-connected" id="payment-status">Connected</span></p>
                        <button class="btn btn-secondary">Manage Stripe</button>
                    </div>
                    <div>
                        <h5>Calendar Integration</h5>
                        <p>Status: <span class="status-connected" id="calendar-status">Connected</span></p>
                        <button class="btn btn-secondary">Manage Calendar</button>
                    </div>
                </div>
                <div style="margin-top: 2rem;">
                    <h5>Business Hours</h5>
                    <p>Monday - Friday: 9 AM - 6 PM</p>
                    <p>Saturday: 10 AM - 4 PM</p>
                    <p>Sunday: Closed</p>
                    <button class="btn btn-secondary">Update Hours</button>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="text-align: center; margin-top: 2rem;">
            <button class="btn btn-success" onclick="goLive()">üöÄ Go Live</button>
            <button class="btn btn-primary" onclick="viewAnalytics()">üìä View Analytics</button>
            <button class="btn btn-secondary" onclick="getSupport()">üÜò Get Support</button>
        </div>
    </div>

    <script type="module">
        import apiClient from './src/api.js';

        let currentBusiness = null;
        let dashboardData = null;

        // Load business data from backend
        async function loadBusinessData() {
            try {
                // Check if user is authenticated
                const authToken = apiClient.getAuthToken();
                if (!authToken) {
                    // Redirect to login if not authenticated
                    window.location.href = '/onboarding.html';
                    return;
                }

                // Get dashboard data from backend
                const response = await apiClient.getDashboardData();
                
                if (response.success && response.data) {
                    dashboardData = response.data;
                    currentBusiness = dashboardData.merchant;
                    
                    // Update business info
                    document.getElementById('business-name').textContent = currentBusiness.name;
                    document.getElementById('ai-phone-number').textContent = currentBusiness.phone || 'Not assigned';

                    // Update stats with real data
                    const kpi = dashboardData.kpi;
                    document.getElementById('total-calls').textContent = kpi.totalCalls || '0';
                    document.getElementById('orders-captured').textContent = kpi.paidOrders || '0';
                    document.getElementById('bookings-made').textContent = kpi.confirmedAppointments || '0';
                    document.getElementById('revenue-today').textContent = `$${kpi.revenue || '0.00'}`;

                    // Update setup status based on real data
                    updateSetupStatus();
                    
                    // Update recent activity
                    updateRecentActivity();
                } else {
                    console.error('Failed to load dashboard data:', response.message);
                    showError('Failed to load dashboard data. Please try again.');
                }

            } catch (error) {
                console.error('Error loading business data:', error);
                showError('Error loading dashboard data. Please check your connection.');
            }
        }

        function updateRecentActivity() {
            if (!dashboardData || !dashboardData.recentActivity) return;
            
            const activityContainer = document.querySelector('.activity-list');
            if (!activityContainer) return;
            
            // Clear existing activity
            activityContainer.innerHTML = '';
            
            // Add recent activities
            dashboardData.recentActivity.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                activityItem.innerHTML = `
                    <div>${activity.description}</div>
                    <div class="activity-time">${activity.timestamp}</div>
                `;
                activityContainer.appendChild(activityItem);
            });
        }

        function showError(message) {
            // Show error message to user
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #fee2e2;
                color: #991b1b;
                padding: 12px 16px;
                border-radius: 8px;
                border: 1px solid #fca5a5;
                z-index: 1000;
            `;
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            // Remove after 5 seconds
            setTimeout(() => {
                document.body.removeChild(errorDiv);
            }, 5000);
        }

        function updateSetupStatus() {
            if (!currentBusiness) return;
            
            const checks = document.querySelectorAll('#setup-status li');
            
            // Business account - always done if we have merchant data
            checks[0].className = 'done';
            
            // Phone number - check if assigned
            if (currentBusiness.phone) {
                checks[1].className = 'done';
            } else {
                checks[1].className = 'pending';
            }
            
            // Payment - check if payment provider is configured
            // This would need to be added to the merchant data structure
            checks[2].className = 'pending'; // TODO: Check payment provider status
            
            // Calendar - check if calendar provider is configured
            // This would need to be added to the merchant data structure
            checks[3].className = 'pending'; // TODO: Check calendar provider status
            
            // Voice AI - always available
            checks[4].className = 'done';
            
            // Live status - check if all required services are configured
            const isLive = currentBusiness.phone && 
                          checks[2].className === 'done' && 
                          checks[3].className === 'done';
            checks[5].className = isLive ? 'done' : 'pending';
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        function runSetupWizard() {
            alert('Opening setup wizard...\n\nThis would guide you through:\n1. Verifying phone number\n2. Testing payment flow\n3. Calendar sync check\n4. Voice AI test call\n5. Going live');
        }

        function showCallForwarding() {
            alert(`Call Forwarding Setup:\n\n1. On your business phone, dial *72\n2. Enter your AI number: ${currentBusiness.phone}\n3. Wait for confirmation tone\n4. Hang up\n\nNow when your line is busy or unanswered, calls will forward to your AI assistant!`);
        }

        function testAI() {
            alert(`Testing AI Assistant...\n\nCall ${currentBusiness.phone} from any phone to test:\n\n‚Ä¢ Press 1 for orders\n‚Ä¢ Press 2 for bookings\n‚Ä¢ Or leave a voicemail\n\nThe AI will respond professionally and handle the request!`);
        }

        function goLive() {
            if (confirm('Ready to go live?\n\nThis will:\n‚Ä¢ Activate your AI assistant\n‚Ä¢ Start capturing missed calls\n‚Ä¢ Process orders and bookings\n‚Ä¢ Send you notifications\n\nContinue?')) {
                alert('üöÄ Congratulations!\n\nYour Callwaiting AI is now LIVE!\n\n‚úÖ AI assistant active\n‚úÖ Capturing missed calls\n‚úÖ Processing orders & bookings\n‚úÖ Sending notifications\n\nYour business will never miss another opportunity!');
                
                // Update status
                const liveStatus = document.querySelector('#setup-status li:last-child');
                liveStatus.className = 'done';
                liveStatus.textContent = 'Live and Capturing Calls';
            }
        }

        function viewAnalytics() {
            alert('Analytics Dashboard\n\nüìä Performance Summary:\n‚Ä¢ 94% call capture rate\n‚Ä¢ $2,450 revenue this week\n‚Ä¢ 15 avg. response time (seconds)\n‚Ä¢ 87% customer satisfaction\n\nDetailed analytics coming soon!');
        }

        function getSupport() {
            alert('üÜò Support Options:\n\nüìß Email: support@callwaitingai.com\nüí¨ Chat: Available 24/7\nüìû Phone: +1 (800) CALL-AI\nüìö Help Center: docs.callwaitingai.com\n\nWe\'re here to help you succeed!');
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadBusinessData);
    </script>
</body>
</html>




